"use strict";(self.webpackChunkdecidim_sb_app=self.webpackChunkdecidim_sb_app||[]).push([[8281],{83307:function(t,e,n){function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e,n){return(e=c(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function c(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===i(e)?e:String(e)}n.d(e,{Z:function(){return s}});var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config={}}var e,n,r;return e=t,n=[{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"object"===i(t)?this.config=a(a({},this.config),t):this.config[t]=e}},{key:"get",value:function(t){return this.config[t]}}],n&&l(e.prototype,n),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},12144:function(t,e,n){var r=n(23972),a=n.n(r);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,i=void 0,i=function(t,e){if("object"!==o(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"),"symbol"===o(i)?i:String(i)),r)}var a,i}var l=null,c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$modal=$(l),this.$source=e,this.$content=$(".confirm-modal-content",this.$modal),this.$buttonConfirm=$("[data-confirm-ok]",this.$modal),this.$buttonCancel=$("[data-confirm-cancel]",this.$modal);var n="confirm-modal-title-".concat(Math.random().toString(36).substring(7));this.$modal.removeAttr("id"),$("#confirm-modal-title",this.$modal).attr("id",n),this.$modal.attr("aria-labelledby",n),$("body").append(this.$modal),this.$modal.foundation()}var e,n,r;return e=t,(n=[{key:"confirm",value:function(t){var e=this;return this.$content.html(t),this.$buttonConfirm.off("click"),this.$buttonCancel.off("click"),new Promise((function(t){e.$buttonConfirm.on("click",(function(n){n.preventDefault(),e.$modal.foundation("close"),t(!0),e.$source.focus()})),e.$buttonCancel.on("click",(function(n){n.preventDefault(),e.$modal.foundation("close"),t(!1),e.$source.focus()})),e.$modal.foundation("open").on("closed.zf.reveal",(function(){e.$modal.remove()}))}))}}])&&i(e.prototype,n),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),s=function(t,e){(function(t,e){var n=$(e).data("confirm");return!n||!!a().fire(e,"confirm")&&(null===l&&(l=$("#confirm-modal")[0].outerHTML,$("#confirm-modal").remove()),new c($(e)).confirm(n).then((function(n){var r=a().fire(e,"confirm:complete",[n]);if(n&&r)if($(e).data("confirm",null),$(e).removeAttr("data-confirm"),"click"===t.type&&($(e).is('button[type="submit"]')||$(e).is('input[type="submit"]')))$(e).parents("form").submit();else{var o=t.originalEvent||t,i=o;"function"===typeof Event&&(i=new o.constructor(o.type,o)),t.target.dispatchEvent(i)}})),!1)})(t,e)||a().stopEverything(t)},d=function(t,e){for(var n=t.target;n instanceof Element&&!a().matches(n,e);)n=n.parentNode;return n instanceof Element?n:null},u=function(t,e){return e.some((function(e){var n=d(t,e);return null!==n&&(s(t,n),!0)}))};document.addEventListener("click",(function(t){return u(t,[a().linkClickSelector,a().buttonClickSelector,a().formInputClickSelector])})),document.addEventListener("change",(function(t){return u(t,[a().inputChangeSelector])})),document.addEventListener("submit",(function(t){return u(t,[a().formSubmitSelector])})),document.addEventListener("DOMContentLoaded",(function(){$(a().formInputClickSelector).on("click.confirm",(function(t){s(t,d(t,a().formInputClickSelector))}))}))},93491:function(t,e,n){var r=n(79292);function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,l=[],c=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){s=!0,a=t}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}(t,e)||function(t,e){if(!t)return;if("string"===typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(o=r.key,i=void 0,i=function(t,e){if("object"!==a(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===a(i)?i:String(i)),r)}var o,i}var c=function(){function t(e,n,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.modal=e,this.uploadItem=n,this.progressBar=n.querySelector(".progress-bar"),this.validationSent=!1,this.fileTooBig=!1,e.options.maxFileSize&&a.file.size>e.options.maxFileSize?(this.fileTooBig=!0,this.showError([e.locales.file_size_too_large])):this.upload=new r.DirectUpload(a.file,a.url,this)}var e,n,a;return e=t,(n=[{key:"showError",value:function(t){this.progressBar.classList.add("filled"),this.progressBar.innerHTML=this.modal.locales.validation_error,this.uploadItem.dataset.state="error";var e=this.uploadItem.querySelector(".upload-errors");t.forEach((function(t){var n=document.createElement("li");n.classList.add("form-error","is-visible"),n.innerHTML=t,e.appendChild(n)}))}},{key:"validate",value:function(t){var e=this;if(!this.validationSent){var n=this.modal.options.addAttribute;this.modal.options.titled&&(n="file");var r=new URLSearchParams({resourceClass:this.modal.options.resourceClass,property:n,blob:t,formClass:this.modal.options.formObjectClass});fetch("/upload_validations?".concat(r.toString()),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":$("meta[name=csrf-token]").attr("content")}}).then((function(t){return t.json()})).then((function(t){!function(t){for(var n=[],r=0,a=Object.entries(t);r<a.length;r++){var i=o(a[r],2)[1];n=n.concat(i)}e.progressBar.style.justifyContent="center",0===n.length?(e.progressBar.innerHTML=e.modal.locales.uploaded,e.uploadItem.dataset.state="validated"):e.showError(n),e.progressBar.classList.add("filled")}(t)})),this.validationSent=!0}}},{key:"directUploadWillStoreFileWithXHR",value:function(t){var e=this;t.upload.addEventListener("progress",(function(t){var n=Math.floor(t.loaded/t.total*100),r="15%";n>15&&(r="".concat(n,"%")),e.progressBar.style.width=r,e.progressBar.innerHTML=100!==n?"".concat(n,"%"):e.modal.locales.validating}))}}])&&l(e.prototype,n),a&&l(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}(),s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:31;if(t.length<=e)return t;var n=Math.floor(e/2)-3,r=e-n-3;return"".concat(t.slice(0,n),"...").concat(t.slice(-r))},d=function(t,e,n){var r=document.createElement("input");return r.type="hidden",t&&(r.className="string"===typeof t?t:t.join(" ")),e&&(r.name=e),n&&(r.value=n),r};function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(a=r.key,o=void 0,o=function(t,e){if("object"!==u(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"),"symbol"===u(o)?o:String(o)),r)}var a,o}var m=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.button=e;var r={};try{r=JSON.parse(e.dataset.upload)}catch(a){}this.options=Object.assign(r,n),this.name=this.button.name,this.modal=document.querySelector("#".concat(e.dataset.open)),this.saveButton=this.modal.querySelector("button.add-file-".concat(this.name)),this.attachmentCounter=0,this.dropZoneEnabled=!0,this.modalTitle=this.modal.querySelector(".reveal__title"),this.uploadItems=this.modal.querySelector(".upload-items"),this.locales=JSON.parse(this.uploadItems.dataset.locales),this.dropZone=this.modal.querySelector(".dropzone"),this.input=this.dropZone.querySelector("input"),this.uploadContainer=document.querySelector(".upload-container-for-".concat(this.name)),this.activeAttachments=this.uploadContainer.querySelector(".active-uploads"),this.trashCan=this.createTrashCan()}var e,n,r;return e=t,(n=[{key:"uploadFile",value:function(t){var e=this;if(this.dropZoneEnabled){var n=t.name.split(".")[0].slice(0,31),r=this.createUploadItem(t.name,n,"init"),a=new c(this,r,{file:t,url:this.input.dataset.directUploadUrl,attachmentName:t.name});a.fileTooBig||(a.upload.create((function(o,i){if(o){r.dataset.state="error";var l=r.querySelector(".progress-bar");l.classList.add("filled"),l.innerHTML=e.locales.error,console.error(o)}else{var c=e.getOrdinalNumber(),s=document.createElement("div");s.classList.add("attachment-details"),s.dataset.filename=t.name;var u=document.createElement("span");u.style.display="none",s.appendChild(u);var p=d(null,null,i.signed_id);if(e.options.titled?p.name="".concat(e.options.resourceName,"[").concat(e.options.addAttribute,"][").concat(c,"][file]"):p.name="".concat(e.options.resourceName,"[").concat(e.options.addAttribute,"]"),e.options.titled){var m=d("hidden-title","".concat(e.options.resourceName,"[").concat(e.options.addAttribute,"][").concat(c,"][title]"),n);u.innerHTML="".concat(n," (").concat(t.name,")"),s.appendChild(m)}else u.innerHTML=t.name;e.options.multiple||e.cleanTrashCan(),s.appendChild(p),r.appendChild(s),a.validate(i.signed_id)}})),this.updateDropZone())}}},{key:"getOrdinalNumber",value:function(){var t=this.attachmentCounter;return this.attachmentCounter+=1,t}},{key:"updateDropZone",value:function(){this.options.multiple||(this.uploadItems.children.length>0?(this.dropZone.classList.add("disabled"),this.dropZoneEnabled=!1,this.input.disabled=!0):(this.dropZone.classList.remove("disabled"),this.dropZoneEnabled=!0,this.input.disabled=!1))}},{key:"createUploadItem",value:function(t,e,n){var r,a=this,o=document.createElement("div");o.classList.add("upload-item"),o.setAttribute("data-filename",t);var i=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div");i.classList.add("row","upload-item-first-row"),l.classList.add("row","upload-item-second-row"),c.classList.add("row","upload-item-third-row");var d=document.createElement("span"),u=["columns","file-name-span"];this.options.titled?u.push("small-4","medium-5"):u.push("small-12"),(r=d.classList).add.apply(r,u),d.innerHTML=s(t);var p=document.createElement("div");p.classList.add("progress-bar"),n&&("validated"===n?p.innerHTML=this.locales.uploaded:(p.innerHTML="0%",p.style.width="15%"),o.dataset.state=n);var m=document.createElement("div");m.classList.add("progress-bar-border"),m.appendChild(p);var f=document.createElement("div");f.classList.add("columns","progress-bar-wrapper"),f.appendChild(m),this.options.titled?f.classList.add("small-4","medium-5"):f.classList.add("small-10");var h=document.createElement("ul");h.classList.add("upload-errors");var v=document.createElement("button");v.classList.add("columns","small-3","medium-2","remove-upload-item"),v.innerHTML="&times; ".concat(this.locales.remove),v.addEventListener("click",(function(e){e.preventDefault();var n=a.uploadItems.querySelector("[data-filename='".concat(t,"']"));a.trashCan.append(n),a.updateDropZone()}));var y=document.createElement("span");y.classList.add("columns","small-5","title-and-filename-span"),y.innerHTML="".concat(e," (").concat(s(t),")"),i.appendChild(d),l.appendChild(f),c.appendChild(h);var b=null;if(this.options.titled){var g=document.createElement("input");g.classList.add("attachment-title"),g.type="text",g.value=e,g.addEventListener("input",(function(t){var e,n,r;t.preventDefault(),e=a.uploadItems,n=a.saveButton,r=!0,Array.from(e.children).forEach((function(t){var e=t.querySelector("input[type='text']").value,a=t.querySelector(".no-title-error");e&&0!==e.length?a.classList.remove("is-visible"):(r=!1,n.disabled=!0,a.classList.add("is-visible"),t.appendChild(a))})),r&&(n.disabled=!1)})),(b=document.createElement("div")).classList.add("columns","small-5","title-input-container"),b.appendChild(g);var S=document.createElement("span");S.classList.add("form-error","no-title-error"),S.role="alert",S.innerHTML=this.locales.title_required,b.appendChild(S);var L=document.createElement("span");L.classList.add("title-label-span"),L.innerHTML=this.locales.title;var C=document.createElement("div");C.classList.add("columns","small-8","medium-7","title-container"),C.appendChild(L),i.appendChild(C),l.appendChild(b)}return l.appendChild(v),o.appendChild(i),o.appendChild(l),o.appendChild(c),this.uploadItems.appendChild(o),o}},{key:"updateAddAttachmentsButton",value:function(){0===this.activeAttachments.children.length?this.button.innerHTML=this.modalTitle.dataset.addlabel:this.button.innerHTML=this.modalTitle.dataset.editlabel}},{key:"createTrashCan",value:function(){var t=document.createElement("div");return t.classList.add("trash-can"),t.style.display="none",this.uploadItems.parentElement.appendChild(t),t}},{key:"cleanTrashCan",value:function(){var t=this;Array.from(this.trashCan.children).forEach((function(e){var n=e.dataset.filename,r=t.activeAttachments.querySelector("div[data-filename='".concat(n,"']"));r&&r.remove(),e.remove()}))}}])&&p(e.prototype,n),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("button.add-file").forEach((function(t){var e=new m(t);!function(t){Array.from(t.activeAttachments.children).forEach((function(e){t.createUploadItem(e.dataset.filename,e.dataset.title,"validated")}))}(e),function(t){t.input.addEventListener("change",(function(e){e.preventDefault();var n=e.target.files;Array.from(n).forEach((function(e){return t.uploadFile(e)}))}))}(e),function(t){t.button.addEventListener("click",(function(e){e.preventDefault(),Array.from(t.trashCan.children).forEach((function(e){t.uploadItems.append(e)})),0===t.uploadItems.children.length?t.modalTitle.innerHTML=t.modalTitle.dataset.addlabel:t.modalTitle.innerHTML=t.modalTitle.dataset.editlabel,t.updateDropZone()}))}(e),function(t){t.dropZone.addEventListener("dragenter",(function(t){t.preventDefault()})),t.dropZone.addEventListener("dragover",(function(e){e.preventDefault(),t.dropZone.classList.add("is-dragover")})),t.dropZone.addEventListener("dragleave",(function(){t.dropZone.classList.remove("is-dragover")})),t.dropZone.addEventListener("drop",(function(e){e.preventDefault();var n=e.dataTransfer.files;Array.from(n).forEach((function(e){return t.uploadFile(e)}))}))}(e),function(t){t.saveButton.addEventListener("click",(function(e){e.preventDefault();var n=t.uploadItems.querySelectorAll(".upload-item[data-state='validated']"),r=n.length;if(n.forEach((function(e){var n=e.querySelector(".attachment-details");n?t.activeAttachments.appendChild(n):n=t.activeAttachments.querySelector(".attachment-details[data-filename='".concat(e.dataset.filename,"'"));var r=n.querySelector("span");if(r.classList.add("filename"),t.options.titled){var a=e.querySelector("input[type='text']").value;n.dataset.title=a;var o=n.querySelector(".hidden-title");if(o)o.value=a;else{var i=n.querySelector("[name='".concat(t.options.resourceName,"[").concat(t.name,"][]'")).value,l=t.getOrdinalNumber(),c=d("hidden-title","".concat(t.options.resourceName,"[").concat(t.options.addAttribute,"][").concat(l,"][title]"),a),u=d("hidden-id","".concat(t.options.resourceName,"[").concat(t.options.addAttribute,"][").concat(l,"][id]"),i);n.appendChild(c),n.appendChild(u)}r.innerHTML="".concat(a," (").concat(s(e.dataset.filename),")")}else r.innerHTML=s(e.dataset.filename,19);r.style.display="block"})),!t.options.titled&&t.trashCan.children.length>0&&(t.activeAttachments.innerHTML="<input name='".concat(t.options.resourceName,"[remove_").concat(t.name,']\' type="hidden" value="true">')),r>0){var a=$(t.uploadContainer.querySelector("input[type='checkbox']"));a&&(a.prop("checked",!0),a.trigger("change"))}t.cleanTrashCan(),t.updateAddAttachmentsButton()}))}(e)}))}))},98731:function(t,e,n){n(72665);$((function(){$(".js-tags-container").tagsinput({tagClass:"input__tag",trimValue:!0})}))}}]);
//# sourceMappingURL=8281-3f78256d8b290e6eadb6.js.map