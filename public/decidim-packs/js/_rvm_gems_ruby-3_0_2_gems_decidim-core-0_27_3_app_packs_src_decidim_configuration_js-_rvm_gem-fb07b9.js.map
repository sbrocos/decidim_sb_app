{"version":3,"file":"js/_rvm_gems_ruby-3_0_2_gems_decidim-core-0_27_3_app_packs_src_decidim_configuration_js-_rvm_gem-fb07b9.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAEA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1KA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpHA;AACA;;AAEA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;ACrQA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChDA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvFA;;AAEA;AACA;AACA;AACA;AAEA;AAgBA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACtJA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA","sources":["webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/configuration.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/confirm.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/direct_uploads/upload_field.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/direct_uploads/upload_modal.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/direct_uploads/upload_utility.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/direct_uploads/uploader.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/editor.js","webpack://decidim-sb-app/../../../.rvm/gems/ruby-3.0.2/gems/decidim-core-0.27.3/app/packs/src/decidim/input_tags.js"],"sourcesContent":["export default class Configuration {\n  constructor() {\n    this.config = {};\n  }\n\n  set(key, value = null) {\n    if (typeof key === \"object\") {\n      this.config = { ...this.config, ...key };\n    } else {\n      this.config[key] = value;\n    }\n  }\n\n  get(key) {\n    return this.config[key];\n  }\n}\n","/**\n * A custom confirm dialog for Decidim based on Foundation reveals.\n *\n * Note that this needs to be loaded before the application JS in order for\n * it to gain control over the confirm events BEFORE rails-ujs is loaded.\n */\n\nimport Rails from \"@rails/ujs\"\n\nlet TEMPLATE_HTML = null;\n\nclass ConfirmDialog {\n  constructor(sourceElement) {\n    this.$modal = $(TEMPLATE_HTML);\n    this.$source = sourceElement;\n    this.$content = $(\".confirm-modal-content\", this.$modal);\n    this.$buttonConfirm = $(\"[data-confirm-ok]\", this.$modal);\n    this.$buttonCancel = $(\"[data-confirm-cancel]\", this.$modal);\n\n    // Avoid duplicate IDs and append the new modal to the body\n    const titleId = `confirm-modal-title-${Math.random().toString(36).substring(7)}`;\n\n    this.$modal.removeAttr(\"id\");\n    $(\"#confirm-modal-title\", this.$modal).attr(\"id\", titleId);\n    this.$modal.attr(\"aria-labelledby\", titleId);\n\n    $(\"body\").append(this.$modal);\n    this.$modal.foundation();\n  }\n\n  confirm(message) {\n    this.$content.html(message);\n\n    this.$buttonConfirm.off(\"click\");\n    this.$buttonCancel.off(\"click\");\n\n    return new Promise((resolve) => {\n      this.$buttonConfirm.on(\"click\", (ev) => {\n        ev.preventDefault();\n\n        this.$modal.foundation(\"close\");\n        resolve(true);\n        this.$source.focus();\n      });\n      this.$buttonCancel.on(\"click\", (ev) => {\n        ev.preventDefault();\n\n        this.$modal.foundation(\"close\");\n        resolve(false);\n        this.$source.focus();\n      });\n\n      this.$modal.foundation(\"open\").on(\"closed.zf.reveal\", () => {\n        this.$modal.remove();\n      });\n    });\n  }\n}\n\n// Override the default confirm dialog by Rails\n// See:\n// https://github.com/rails/rails/blob/fba1064153d8e2f4654df7762a7d3664b93e9fc8/actionview/app/assets/javascripts/rails-ujs/features/confirm.coffee\n//\n// There is apparently a better way coming in Rails 6:\n// https://github.com/rails/rails/commit/e9aa7ecdee0aa7bb4dcfa5046881bde2f1fe21cc#diff-e1aaa45200e9adcbcb8baf1c5375b5d1\n//\n// The old approach is broken according to https://github.com/rails/rails/issues/36686#issuecomment-514213323\n// so for the moment this needs to be executed **before** Rails.start()\nconst allowAction = (ev, element) => {\n  const message = $(element).data(\"confirm\");\n  if (!message) {\n    return true;\n  }\n\n  if (!Rails.fire(element, \"confirm\")) {\n    return false;\n  }\n\n  if (TEMPLATE_HTML === null) {\n    TEMPLATE_HTML = $(\"#confirm-modal\")[0].outerHTML;\n    $(\"#confirm-modal\").remove();\n  }\n\n  const dialog = new ConfirmDialog(\n    $(element)\n  );\n  dialog.confirm(message).then((answer) => {\n    const completed = Rails.fire(element, \"confirm:complete\", [answer]);\n    if (answer && completed) {\n      // Allow the event to propagate normally and re-dispatch it without\n      // the confirm data attribute which the Rails internal method is\n      // checking.\n      $(element).data(\"confirm\", null);\n      $(element).removeAttr(\"data-confirm\");\n\n      // The submit button click events won't do anything if they are\n      // dispatched as is. In these cases, just submit the underlying form.\n      if (ev.type === \"click\" &&\n        (\n          $(element).is('button[type=\"submit\"]') ||\n          $(element).is('input[type=\"submit\"]')\n        )\n      ) {\n        $(element).parents(\"form\").submit();\n      } else {\n        let origEv = ev.originalEvent || ev;\n        let newEv = origEv;\n        if (typeof Event === \"function\") {\n          // Clone the event because otherwise some click events may not\n          // work properly when re-dispatched.\n          newEv = new origEv.constructor(origEv.type, origEv);\n        }\n        ev.target.dispatchEvent(newEv);\n      }\n    }\n  });\n\n  return false;\n};\nconst handleConfirm = (ev, element) => {\n  if (!allowAction(ev, element)) {\n    Rails.stopEverything(ev);\n  }\n};\nconst getMatchingEventTarget = (ev, selector) => {\n  let target = ev.target;\n  while (!(!(target instanceof Element) || Rails.matches(target, selector))) {\n    target = target.parentNode;\n  }\n\n  if (target instanceof Element) {\n    return target;\n  }\n\n  return null;\n};\nconst handleDocumentEvent = (ev, matchSelectors) => {\n  return matchSelectors.some((currentSelector) => {\n    let target = getMatchingEventTarget(ev, currentSelector);\n    if (target === null) {\n      return false;\n    }\n\n    handleConfirm(ev, target);\n    return true;\n  });\n};\n\ndocument.addEventListener(\"click\", (ev) => {\n  return handleDocumentEvent(ev, [\n    Rails.linkClickSelector,\n    Rails.buttonClickSelector,\n    Rails.formInputClickSelector\n  ]);\n});\ndocument.addEventListener(\"change\", (ev) => {\n  return handleDocumentEvent(ev, [Rails.inputChangeSelector]);\n});\ndocument.addEventListener(\"submit\", (ev) => {\n  return handleDocumentEvent(ev, [Rails.formSubmitSelector]);\n});\n\n// This is needed for the confirm dialog to work with Foundation Abide.\n// Abide registers its own submit click listeners since Foundation 5.6.x\n// which will be handled before the document listeners above. This would\n// break the custom confirm functionality when used with Foundation Abide.\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  $(Rails.formInputClickSelector).on(\"click.confirm\", (ev) => {\n    handleConfirm(ev, getMatchingEventTarget(ev, Rails.formInputClickSelector));\n  });\n});\n","import UploadModal from \"src/decidim/direct_uploads/upload_modal\";\nimport { truncateFilename, createHiddenInput } from \"src/decidim/direct_uploads/upload_utility\";\n\nconst loadAttachments = (modal) => {\n  Array.from(modal.activeAttachments.children).forEach((child) => {\n    modal.createUploadItem(child.dataset.filename, child.dataset.title, \"validated\");\n  })\n}\n\nconst addInputEventListener = (modal) => {\n  modal.input.addEventListener(\"change\", (event) => {\n    event.preventDefault();\n    const files = event.target.files;\n    Array.from(files).forEach((file) => modal.uploadFile(file));\n  })\n}\n\nconst addButtonEventListener = (modal) => {\n  modal.button.addEventListener(\"click\", (event) => {\n    event.preventDefault();\n    Array.from(modal.trashCan.children).forEach((item) => {\n      modal.uploadItems.append(item);\n    })\n    if (modal.uploadItems.children.length === 0) {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.addlabel;\n    } else {\n      modal.modalTitle.innerHTML = modal.modalTitle.dataset.editlabel;\n    }\n    modal.updateDropZone();\n  })\n}\n\nconst addDropZoneEventListeners = (modal) => {\n  modal.dropZone.addEventListener(\"dragenter\", (event) => {\n    event.preventDefault();\n  })\n\n  modal.dropZone.addEventListener(\"dragover\", (event) => {\n    event.preventDefault();\n    modal.dropZone.classList.add(\"is-dragover\");\n  })\n\n  modal.dropZone.addEventListener(\"dragleave\", () => {\n    modal.dropZone.classList.remove(\"is-dragover\");\n  })\n\n  modal.dropZone.addEventListener(\"drop\", (event) => {\n    event.preventDefault();\n    const files = event.dataTransfer.files;\n    Array.from(files).forEach((file) => modal.uploadFile(file));\n  })\n}\n\nconst addSaveButtonEventListener = (modal) => {\n  modal.saveButton.addEventListener(\"click\", (event) => {\n    event.preventDefault();\n    const validatedItems = modal.uploadItems.querySelectorAll(\".upload-item[data-state='validated']\")\n    const validatedItemsCount = validatedItems.length;\n    validatedItems.forEach((item) => {\n      let details = item.querySelector(\".attachment-details\");\n      if (details) {\n        modal.activeAttachments.appendChild(details);\n      } else {\n        details = modal.activeAttachments.querySelector(`.attachment-details[data-filename='${item.dataset.filename}'`);\n      }\n      const span = details.querySelector(\"span\");\n      span.classList.add(\"filename\");\n      if (modal.options.titled) {\n        const title = item.querySelector(\"input[type='text']\").value;\n        details.dataset.title = title;\n        let hiddenTitle = details.querySelector(\".hidden-title\")\n        if (hiddenTitle) {\n          hiddenTitle.value = title;\n        } else {\n          const attachmentId = details.querySelector(`[name='${modal.options.resourceName}[${modal.name}][]'`).value\n          const ordinalNumber = modal.getOrdinalNumber()\n          const hiddenTitleField = createHiddenInput(\"hidden-title\", `${modal.options.resourceName}[${modal.options.addAttribute}][${ordinalNumber}][title]`, title)\n          const hiddenIdField = createHiddenInput(\"hidden-id\", `${modal.options.resourceName}[${modal.options.addAttribute}][${ordinalNumber}][id]`, attachmentId)\n          details.appendChild(hiddenTitleField);\n          details.appendChild(hiddenIdField);\n        }\n        span.innerHTML = `${title} (${truncateFilename(item.dataset.filename)})`;\n      } else {\n        span.innerHTML = truncateFilename(item.dataset.filename, 19);\n      }\n      span.style.display = \"block\";\n    });\n\n    if (!modal.options.titled && modal.trashCan.children.length > 0) {\n      modal.activeAttachments.innerHTML = `<input name='${modal.options.resourceName}[remove_${modal.name}]' type=\"hidden\" value=\"true\">`;\n    }\n\n    if (validatedItemsCount > 0) {\n      // Foundation helper does some magic with error fields, so these must be triggered using jQuery.\n      const $el = $(modal.uploadContainer.querySelector(\"input[type='checkbox']\"));\n      if ($el) {\n        $el.prop(\"checked\", true);\n        $el.trigger(\"change\");\n      }\n    }\n    modal.cleanTrashCan();\n    modal.updateAddAttachmentsButton();\n  });\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const attachmentButtons = document.querySelectorAll(\"button.add-file\");\n\n  attachmentButtons.forEach((attachmentButton) => {\n    const modal = new UploadModal(attachmentButton);\n    loadAttachments(modal);\n    addInputEventListener(modal);\n    addButtonEventListener(modal);\n    addDropZoneEventListeners(modal);\n    addSaveButtonEventListener(modal);\n  })\n})\n","import { Uploader } from \"src/decidim/direct_uploads/uploader\";\nimport { truncateFilename, checkTitles, createHiddenInput } from \"src/decidim/direct_uploads/upload_utility\";\n\n// This class handles logic inside upload modal, but since modal is not inside the form\n// logic here moves \"upload items\" / hidden inputs to form.\nexport default class UploadModal {\n  constructor(button, options = {}) {\n    // Button that opens the modal.\n    this.button = button;\n\n    // The provided options contains the options passed from the view in the\n    // `data-upload` attribute as a JSON.\n    let providedOptions = {};\n    try {\n      // The providedOptions can contain the following keys:\n      // - addAttribute - Field name / attribute of resource (e.g. avatar)\n      // - resourceName - The resource to which the attribute belongs (e.g. user)\n      // - resourceClass - Ruby class of the resource (e.g. Decidim::User)\n      // - multiple - Defines if multiple files can be uploaded\n      // - titled - Defines if file(s) can have titles\n      // - maxFileSize - Defines maximum file size in bytes\n      // - formObjectClass - Class of the current form object (e.g. Decidim::AccountForm)\n      providedOptions = JSON.parse(button.dataset.upload);\n    } catch (_e) {\n      // Don't care about the parse errors, just skip the provided options.\n    }\n\n    this.options = Object.assign(providedOptions, options)\n\n    this.name = this.button.name;\n    this.modal = document.querySelector(`#${button.dataset.open}`);\n    this.saveButton = this.modal.querySelector(`button.add-file-${this.name}`);\n    this.attachmentCounter = 0;\n    this.dropZoneEnabled = true;\n    this.modalTitle = this.modal.querySelector(\".reveal__title\");\n    this.uploadItems = this.modal.querySelector(\".upload-items\");\n    this.locales = JSON.parse(this.uploadItems.dataset.locales);\n    this.dropZone = this.modal.querySelector(\".dropzone\");\n    this.input = this.dropZone.querySelector(\"input\");\n    this.uploadContainer = document.querySelector(`.upload-container-for-${this.name}`);\n    this.activeAttachments = this.uploadContainer.querySelector(\".active-uploads\");\n    this.trashCan = this.createTrashCan();\n  }\n\n  uploadFile(file) {\n    if (!this.dropZoneEnabled) {\n      return;\n    }\n\n    const title = file.name.split(\".\")[0].slice(0, 31);\n    const uploadItem = this.createUploadItem(file.name, title, \"init\");\n    const uploader = new Uploader(this, uploadItem, {\n      file: file,\n      url: this.input.dataset.directUploadUrl,\n      attachmentName: file.name\n    });\n    if (uploader.fileTooBig) {\n      return;\n    }\n\n    uploader.upload.create((error, blob) => {\n      if (error) {\n        uploadItem.dataset.state = \"error\";\n        const progressBar = uploadItem.querySelector(\".progress-bar\");\n        progressBar.classList.add(\"filled\");\n        progressBar.innerHTML = this.locales.error;\n        console.error(error);\n      } else {\n        const ordinalNumber = this.getOrdinalNumber();\n\n        const attachmentDetails = document.createElement(\"div\");\n        attachmentDetails.classList.add(\"attachment-details\");\n        attachmentDetails.dataset.filename = file.name;\n        const titleAndFileNameSpan = document.createElement(\"span\");\n        titleAndFileNameSpan.style.display = \"none\";\n        attachmentDetails.appendChild(titleAndFileNameSpan);\n\n        const hiddenBlobField = createHiddenInput(null, null, blob.signed_id);\n        if (this.options.titled) {\n          hiddenBlobField.name = `${this.options.resourceName}[${this.options.addAttribute}][${ordinalNumber}][file]`;\n        } else {\n          hiddenBlobField.name = `${this.options.resourceName}[${this.options.addAttribute}]`;\n        }\n\n        if (this.options.titled) {\n          const hiddenTitleField = createHiddenInput(\"hidden-title\", `${this.options.resourceName}[${this.options.addAttribute}][${ordinalNumber}][title]`, title);\n          titleAndFileNameSpan.innerHTML = `${title} (${file.name})`;\n          attachmentDetails.appendChild(hiddenTitleField);\n        } else {\n          titleAndFileNameSpan.innerHTML = file.name;\n        }\n\n        if (!this.options.multiple) {\n          this.cleanTrashCan();\n        }\n\n        attachmentDetails.appendChild(hiddenBlobField);\n        uploadItem.appendChild(attachmentDetails);\n        uploader.validate(blob.signed_id);\n      }\n    });\n    this.updateDropZone();\n  }\n\n  getOrdinalNumber() {\n    const nextOrdinalNumber = this.attachmentCounter;\n    this.attachmentCounter += 1;\n    return nextOrdinalNumber;\n  }\n\n  updateDropZone() {\n    if (this.options.multiple) {\n      return;\n    }\n\n    if (this.uploadItems.children.length > 0) {\n      this.dropZone.classList.add(\"disabled\");\n      this.dropZoneEnabled = false;\n      this.input.disabled = true;\n    } else {\n      this.dropZone.classList.remove(\"disabled\");\n      this.dropZoneEnabled = true;\n      this.input.disabled = false;\n    }\n  }\n\n  createUploadItem(fileName, title, state) {\n    const wrapper = document.createElement(\"div\");\n    wrapper.classList.add(\"upload-item\");\n    wrapper.setAttribute(\"data-filename\", fileName);\n\n    const firstRow = document.createElement(\"div\");\n    const secondRow = document.createElement(\"div\");\n    const thirdRow = document.createElement(\"div\");\n    firstRow.classList.add(\"row\", \"upload-item-first-row\");\n    secondRow.classList.add(\"row\", \"upload-item-second-row\");\n    thirdRow.classList.add(\"row\", \"upload-item-third-row\");\n\n    const fileNameSpan = document.createElement(\"span\");\n    let fileNameSpanClasses = [\"columns\", \"file-name-span\"];\n    if (this.options.titled) {\n      fileNameSpanClasses.push(\"small-4\", \"medium-5\");\n    } else {\n      fileNameSpanClasses.push(\"small-12\");\n    }\n    fileNameSpan.classList.add(...fileNameSpanClasses);\n    fileNameSpan.innerHTML = truncateFilename(fileName);\n\n    const progressBar = document.createElement(\"div\");\n    progressBar.classList.add(\"progress-bar\");\n    if (state) {\n      if (state === \"validated\") {\n        progressBar.innerHTML = this.locales.uploaded;\n      } else {\n        progressBar.innerHTML = \"0%\";\n        progressBar.style.width = \"15%\";\n      }\n      wrapper.dataset.state = state;\n    }\n\n    const progressBarBorder = document.createElement(\"div\");\n    progressBarBorder.classList.add(\"progress-bar-border\");\n    progressBarBorder.appendChild(progressBar);\n\n    const progressBarWrapper = document.createElement(\"div\");\n    progressBarWrapper.classList.add(\"columns\", \"progress-bar-wrapper\");\n    progressBarWrapper.appendChild(progressBarBorder);\n    if (this.options.titled) {\n      progressBarWrapper.classList.add(\"small-4\", \"medium-5\");\n    } else {\n      progressBarWrapper.classList.add(\"small-10\");\n    }\n\n    const errorList = document.createElement(\"ul\");\n    errorList.classList.add(\"upload-errors\");\n\n    const removeButton = document.createElement(\"button\");\n    removeButton.classList.add(\"columns\", \"small-3\", \"medium-2\", \"remove-upload-item\");\n    removeButton.innerHTML = `&times; ${this.locales.remove}`;\n    removeButton.addEventListener((\"click\"), (event) => {\n      event.preventDefault();\n      const item = this.uploadItems.querySelector(`[data-filename='${fileName}']`);\n      this.trashCan.append(item);\n      this.updateDropZone();\n    })\n\n    const titleAndFileNameSpan = document.createElement(\"span\");\n    titleAndFileNameSpan.classList.add(\"columns\", \"small-5\", \"title-and-filename-span\");\n    titleAndFileNameSpan.innerHTML = `${title} (${truncateFilename(fileName)})`;\n\n    firstRow.appendChild(fileNameSpan);\n    secondRow.appendChild(progressBarWrapper);\n    thirdRow.appendChild(errorList);\n\n    let titleInputContainer = null;\n    if (this.options.titled) {\n      const titleInput = document.createElement(\"input\");\n      titleInput.classList.add(\"attachment-title\");\n      titleInput.type = \"text\";\n      titleInput.value = title;\n      titleInput.addEventListener(\"input\", (event) => {\n        event.preventDefault();\n        checkTitles(this.uploadItems, this.saveButton);\n      })\n      titleInputContainer = document.createElement(\"div\");\n      titleInputContainer.classList.add(\"columns\", \"small-5\", \"title-input-container\");\n      titleInputContainer.appendChild(titleInput);\n\n      const noTitleErrorSpan = document.createElement(\"span\");\n      noTitleErrorSpan.classList.add(\"form-error\", \"no-title-error\");\n      noTitleErrorSpan.role = \"alert\";\n      noTitleErrorSpan.innerHTML = this.locales.title_required;\n      titleInputContainer.appendChild(noTitleErrorSpan);\n\n      const titleLabelSpan = document.createElement(\"span\");\n      titleLabelSpan.classList.add(\"title-label-span\");\n      titleLabelSpan.innerHTML = this.locales.title;\n\n      const titleContainer = document.createElement(\"div\");\n      titleContainer.classList.add(\"columns\", \"small-8\", \"medium-7\", \"title-container\");\n      titleContainer.appendChild(titleLabelSpan);\n      firstRow.appendChild(titleContainer);\n      secondRow.appendChild(titleInputContainer);\n    }\n\n    secondRow.appendChild(removeButton);\n\n    wrapper.appendChild(firstRow);\n    wrapper.appendChild(secondRow);\n    wrapper.appendChild(thirdRow);\n\n    this.uploadItems.appendChild(wrapper);\n\n    return wrapper;\n  }\n\n  updateAddAttachmentsButton() {\n    if (this.activeAttachments.children.length === 0) {\n      this.button.innerHTML = this.modalTitle.dataset.addlabel;\n    } else {\n      this.button.innerHTML = this.modalTitle.dataset.editlabel;\n    }\n  }\n\n  createTrashCan() {\n    const trashCan =  document.createElement(\"div\");\n    trashCan.classList.add(\"trash-can\");\n    trashCan.style.display = \"none\";\n    this.uploadItems.parentElement.appendChild(trashCan);\n    return trashCan;\n  }\n\n  cleanTrashCan() {\n    Array.from(this.trashCan.children).forEach((item) => {\n      const fileName = item.dataset.filename;\n      const activeAttachment = this.activeAttachments.querySelector(`div[data-filename='${fileName}']`);\n      if (activeAttachment) {\n        activeAttachment.remove();\n      }\n      item.remove();\n    })\n  }\n}\n","export const checkTitles = (parentElement, saveButton) => {\n  let everyItemHasTitle = true;\n\n  Array.from(parentElement.children).forEach((item) => {\n    const title = item.querySelector(\"input[type='text']\").value;\n    const noTitleErrorSpan = item.querySelector(\".no-title-error\");\n    if (!title || title.length === 0) {\n      everyItemHasTitle = false;\n      saveButton.disabled = true;\n      noTitleErrorSpan.classList.add(\"is-visible\");\n      item.appendChild(noTitleErrorSpan);\n    } else {\n      noTitleErrorSpan.classList.remove(\"is-visible\");\n    }\n  });\n\n  if (everyItemHasTitle) {\n    saveButton.disabled = false;\n  }\n}\n\nexport const truncateFilename = (filename, maxLength = 31) => {\n  if (filename.length <= maxLength) {\n    return filename;\n  }\n\n  const charactersFromBegin = Math.floor(maxLength / 2) - 3;\n  const charactersFromEnd = maxLength - charactersFromBegin - 3;\n  return `${filename.slice(0, charactersFromBegin)}...${filename.slice(-charactersFromEnd)}`;\n}\n\nexport const createHiddenInput = (elClasses, elName, elValue) => {\n  const el = document.createElement(\"input\");\n  el.type = \"hidden\";\n  if (elClasses) {\n    if (typeof (elClasses) === \"string\") {\n      el.className = elClasses;\n    } else {\n      el.className = elClasses.join(\" \")\n    }\n  }\n  if (elName) {\n    el.name = elName;\n  }\n  if (elValue) {\n    el.value = elValue;\n  }\n  return el;\n}\n","import { DirectUpload } from \"@rails/activestorage\";\n\nexport class Uploader {\n  constructor(modal, uploadItem, options) {\n    this.modal = modal;\n    this.uploadItem = uploadItem;\n    this.progressBar = uploadItem.querySelector(\".progress-bar\");\n    this.validationSent = false;\n    this.fileTooBig = false;\n    if (modal.options.maxFileSize && options.file.size > modal.options.maxFileSize) {\n      this.fileTooBig = true;\n      this.showError([modal.locales.file_size_too_large]);\n    } else {\n      this.upload = new DirectUpload(options.file, options.url, this);\n    }\n  }\n\n  showError(errors) {\n    this.progressBar.classList.add(\"filled\");\n    this.progressBar.innerHTML = this.modal.locales.validation_error;\n    this.uploadItem.dataset.state = \"error\";\n    const errorList = this.uploadItem.querySelector(\".upload-errors\");\n    errors.forEach((error) => {\n      const errorItem = document.createElement(\"li\");\n      errorItem.classList.add(\"form-error\", \"is-visible\");\n      errorItem.innerHTML = error;\n      errorList.appendChild(errorItem);\n    })\n  }\n\n  validate(blobId) {\n    const callback = (data) => {\n      let errors = []\n      for (const [, value] of Object.entries(data)) {\n        errors = errors.concat(value);\n      }\n\n      this.progressBar.style.justifyContent = \"center\";\n      if (errors.length === 0) {\n        this.progressBar.innerHTML = this.modal.locales.uploaded;\n        this.uploadItem.dataset.state = \"validated\";\n      } else {\n        this.showError(errors);\n      }\n      this.progressBar.classList.add(\"filled\");\n    }\n\n    if (!this.validationSent) {\n      let property = this.modal.options.addAttribute;\n      if (this.modal.options.titled) {\n        property = \"file\"\n      }\n      const params = new URLSearchParams({\n        resourceClass: this.modal.options.resourceClass,\n        property: property,\n        blob: blobId,\n        formClass: this.modal.options.formObjectClass\n      });\n\n      fetch(`/upload_validations?${params.toString()}`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n        }\n      }).then((response) => response.json()).then((data) => {\n        callback(data);\n      });\n      this.validationSent = true;\n    }\n  }\n\n  directUploadWillStoreFileWithXHR(request) {\n    request.upload.addEventListener(\"progress\", (event) => {\n      const progress = Math.floor(event.loaded / event.total * 100);\n      let width = \"15%\";\n      if (progress > 15) {\n        width = `${progress}%`;\n      }\n      this.progressBar.style.width = width;\n\n      if (progress === 100) {\n        this.progressBar.innerHTML = this.modal.locales.validating;\n        return;\n      }\n      this.progressBar.innerHTML = `${progress}%`;\n    });\n  }\n}\n","/* eslint-disable require-jsdoc */\n\nimport lineBreakButtonHandler from \"src/decidim/editor/linebreak_module\";\nimport \"src/decidim/editor/clipboard_override\";\nimport \"src/decidim/vendor/image-resize.min\";\nimport \"src/decidim/vendor/image-upload.min\";\n\nconst quillFormats = [\n  \"bold\",\n  \"italic\",\n  \"link\",\n  \"underline\",\n  \"header\",\n  \"list\",\n  \"alt\",\n  \"break\",\n  \"width\",\n  \"style\",\n  \"code\",\n  \"blockquote\",\n  \"indent\"\n];\n\nexport default function createQuillEditor(container) {\n  const toolbar = $(container).data(\"toolbar\");\n  const disabled = $(container).data(\"disabled\");\n\n  const allowedEmptyContentSelector = \"iframe\";\n  let quillToolbar = [\n    [\"bold\", \"italic\", \"underline\", \"linebreak\"],\n    [{ list: \"ordered\" }, { list: \"bullet\" }],\n    [\"link\", \"clean\"],\n    [\"code\", \"blockquote\"],\n    [{ indent: \"-1\" }, { indent: \"+1\" }]\n  ];\n\n  let addImage = false;\n  let addVideo = false;\n\n  /**\n   * - basic = only basic controls without titles\n   * - content = basic + headings\n   * - full = basic + headings + image + video\n   */\n  if (toolbar === \"content\") {\n    quillToolbar = [[{ header: [2, 3, 4, 5, 6, false] }], ...quillToolbar];\n  } else if (toolbar === \"full\") {\n    addImage = true;\n    addVideo = true;\n    quillToolbar = [\n      [{ header: [2, 3, 4, 5, 6, false] }],\n      ...quillToolbar,\n      [\"video\"],\n      [\"image\"]\n    ];\n  }\n\n  let modules = {\n    linebreak: {},\n    toolbar: {\n      container: quillToolbar,\n      handlers: {\n        linebreak: lineBreakButtonHandler\n      }\n    }\n  };\n  const $input = $(container).siblings('input[type=\"hidden\"]');\n  container.innerHTML = $input.val() || \"\";\n  const token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n\n  if (addVideo) {\n    quillFormats.push(\"video\");\n  }\n\n  if (addImage) {\n    // Attempt to allow images only if the image support is enabled at editor support.\n    // see: https://github.com/quilljs/quill/issues/1108\n    quillFormats.push(\"image\");\n\n    modules.imageResize = {\n      modules: [\"Resize\", \"DisplaySize\"]\n    };\n    modules.imageUpload = {\n      url: $(container).data(\"uploadImagesPath\"),\n      method: \"POST\",\n      name: \"image\",\n      withCredentials: false,\n      headers: { \"X-CSRF-Token\": token },\n      callbackOK: (serverResponse, next) => {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        next(serverResponse.url);\n      },\n      callbackKO: (serverError) => {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        console.log(`Image upload error: ${serverError.message}`);\n      },\n      checkBeforeSend: (file, next) => {\n        $(\"div.ql-toolbar\").last().addClass(\"editor-loading\");\n        next(file);\n      }\n    };\n\n    const text = $(container).data(\"dragAndDropHelpText\");\n    $(container).after(\n      `<p class=\"help-text\" style=\"margin-top:-1.5rem;\">${text}</p>`\n    );\n  }\n  const quill = new Quill(container, {\n    modules: modules,\n    formats: quillFormats,\n    theme: \"snow\"\n  });\n\n  if (addImage === false) {\n    // Firefox natively implements image drop in contenteditable which is why we need to disable that\n    quill.root.addEventListener(\"drop\", (ev) => ev.preventDefault());\n  }\n\n  if (disabled) {\n    quill.disable();\n  }\n\n  quill.on(\"text-change\", () => {\n    const text = quill.getText();\n\n    // Triggers CustomEvent with the cursor position\n    // It is required in input_mentions.js\n    let event = new CustomEvent(\"quill-position\", {\n      detail: quill.getSelection()\n    });\n    container.dispatchEvent(event);\n\n    if (\n      (text === \"\\n\" || text === \"\\n\\n\") &&\n      quill.root.querySelectorAll(allowedEmptyContentSelector).length === 0\n    ) {\n      $input.val(\"\");\n    } else {\n      const emptyParagraph = \"<p><br></p>\";\n      const cleanHTML = quill.root.innerHTML.replace(\n        new RegExp(`^${emptyParagraph}|${emptyParagraph}$`, \"g\"),\n        \"\"\n      );\n      $input.val(cleanHTML);\n    }\n  });\n  // After editor is ready, linebreak_module deletes two extraneous new lines\n  quill.emitter.emit(\"editor-ready\");\n\n  return quill;\n}\n","import \"bootstrap-tagsinput\"\n\n$(() => {\n  const $tagContainer = $(\".js-tags-container\");\n\n  // Initialize\n  $tagContainer.tagsinput({\n    tagClass: \"input__tag\",\n    trimValue: true\n  });\n\n});\n"],"names":[],"sourceRoot":""}